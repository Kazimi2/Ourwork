<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>答题系统最终验证测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .quiz-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .quiz-question {
            margin: 15px 0;
            padding: 10px;
            border-left: 3px solid #007bff;
        }
        .quiz-results {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>答题系统最终验证测试</h1>
    
    <div class="test-section">
        <h2>测试说明</h2>
        <p>这个测试将验证答题系统的所有功能是否正常工作，包括：</p>
        <ol>
            <li>JavaScript文件加载</li>
            <li>答题数据正确性</li>
            <li>表单提交功能</li>
            <li>分数计算</li>
            <li>结果展示</li>
            <li>重置功能</li>
        </ol>
        
        <button onclick="runAllTests()">运行自动测试</button>
        <button onclick="openMainPage()">打开主页面测试</button>
    </div>
    
    <div id="test-results" class="test-section">
        <h2>测试结果</h2>
        <div id="test-output"></div>
    </div>
    
    <div class="quiz-container">
        <h2>实际答题测试</h2>
        <p>请回答以下问题，然后点击"提交答案"按钮：</p>
        
        <form id="quiz-form">
            <div class="quiz-question">
                <h3>1. 鸦片战争爆发于哪一年？</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q1" value="A"> A. 1839年</label><br>
                    <label><input type="radio" name="q1" value="B"> B. 1840年</label><br>
                    <label><input type="radio" name="q1" value="C"> C. 1842年</label><br>
                    <label><input type="radio" name="q1" value="D"> D. 1856年</label>
                </div>
            </div>
            
            <div class="quiz-question">
                <h3>2. 《南京条约》开放的通商口岸不包括？</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q2" value="A"> A. 上海</label><br>
                    <label><input type="radio" name="q2" value="B"> B. 广州</label><br>
                    <label><input type="radio" name="q2" value="C"> C. 天津</label><br>
                    <label><input type="radio" name="q2" value="D"> D. 宁波</label>
                </div>
            </div>
            
            <div class="quiz-question">
                <h3>3. 虎门销烟的主要负责人是谁？</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q3" value="A"> A. 道光皇帝</label><br>
                    <label><input type="radio" name="q3" value="B"> B. 林则徐</label><br>
                    <label><input type="radio" name="q3" value="C"> C. 关天培</label><br>
                    <label><input type="radio" name="q3" value="D"> D. 琦善</label>
                </div>
            </div>
            
            <div class="quiz-question">
                <h3>4. 鸦片战争后割让给英国的是？</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q4" value="A"> A. 香港岛</label><br>
                    <label><input type="radio" name="q4" value="B"> B. 澳门</label><br>
                    <label><input type="radio" name="q4" value="C"> C. 台湾</label><br>
                    <label><input type="radio" name="q4" value="D"> D. 澎湖列岛</label>
                </div>
            </div>
            
            <div class="quiz-question">
                <h3>5. 下列哪项不是《南京条约》的内容？</h3>
                <div class="quiz-options">
                    <label><input type="radio" name="q5" value="A"> A. 赔款2100万银元</label><br>
                    <label><input type="radio" name="q5" value="B"> B. 协定关税</label><br>
                    <label><input type="radio" name="q5" value="C"> C. 领事裁判权</label><br>
                    <label><input type="radio" name="q5" value="D"> D. 开设工厂权</label>
                </div>
            </div>
            
            <div class="quiz-actions">
                <button type="button" id="submit-quiz">提交答案</button>
                <button type="button" id="reset-quiz">重新开始</button>
            </div>
        </form>
        
        <div id="quiz-results" class="quiz-results hidden">
            <h3>答题结果</h3>
            <div class="score-display">
                得分：<span id="score">0</span>/5
            </div>
            <div id="answer-feedback" class="answer-feedback">
                <!-- 反馈内容将通过JavaScript动态生成 -->
            </div>
        </div>
    </div>
    
    <script src="scripts/quiz.js"></script>
    <script>
        // 初始化事件监听器
        window.addEventListener('load', function() {
            const submitBtn = document.getElementById('submit-quiz');
            const resetBtn = document.getElementById('reset-quiz');
            
            if (submitBtn && resetBtn && typeof handleQuizSubmit !== 'undefined' && typeof resetQuiz !== 'undefined') {
                submitBtn.onclick = handleQuizSubmit;
                resetBtn.onclick = resetQuiz;
                logTestResult('事件监听器初始化', true, '事件监听器初始化成功');
            } else {
                logTestResult('事件监听器初始化', false, '事件监听器初始化失败');
            }
        });
        
        // 运行所有测试
        function runAllTests() {
            const output = document.getElementById('test-output');
            output.innerHTML = '';
            
            // 测试1：检查quiz.js是否加载
            if (typeof quizData !== 'undefined' && typeof handleQuizSubmit !== 'undefined') {
                logTestResult('quiz.js文件加载', true, 'quiz.js文件加载成功');
            } else {
                logTestResult('quiz.js文件加载', false, 'quiz.js文件加载失败');
                return;
            }
            
            // 测试2：检查quizData是否正确
            if (quizData.length === 5) {
                logTestResult('quizData数据', true, `quizData包含5道题，正确`);
            } else {
                logTestResult('quizData数据', false, `quizData包含${quizData.length}道题，预期5道`);
            }
            
            // 测试3：检查每道题的数据结构
            let allQuestionsValid = true;
            quizData.forEach((question, index) => {
                const hasQuestion = question.question && question.question.length > 0;
                const hasOptions = question.options && Object.keys(question.options).length === 4;
                const hasCorrectAnswer = question.correctAnswer && ['A','B','C','D'].includes(question.correctAnswer);
                const hasExplanation = question.explanation && question.explanation.length > 0;
                
                if (hasQuestion && hasOptions && hasCorrectAnswer && hasExplanation) {
                    logTestResult(`第${index+1}题数据结构`, true, `第${index+1}题数据结构完整`);
                } else {
                    logTestResult(`第${index+1}题数据结构`, false, `第${index+1}题数据结构不完整`);
                    allQuestionsValid = false;
                }
            });
            
            if (allQuestionsValid) {
                logTestResult('所有题目数据结构', true, '所有题目数据结构完整');
            }
            
            // 测试4：模拟正确答案提交
            setTimeout(() => {
                // 选择正确答案
                document.querySelector('input[name="q1"][value="B"]').checked = true;
                document.querySelector('input[name="q2"][value="C"]').checked = true;
                document.querySelector('input[name="q3"][value="B"]').checked = true;
                document.querySelector('input[name="q4"][value="A"]').checked = true;
                document.querySelector('input[name="q5"][value="D"]').checked = true;
                
                // 提交答案
                handleQuizSubmit();
                
                // 检查结果
                setTimeout(() => {
                    const score = document.getElementById('score').textContent;
                    const resultsVisible = !document.getElementById('quiz-results').classList.contains('hidden');
                    
                    if (resultsVisible && score === '5') {
                        logTestResult('答题提交功能', true, '答题提交功能正常工作，得分：5/5');
                    } else {
                        logTestResult('答题提交功能', false, `答题提交功能异常，得分：${score}/5，结果可见：${resultsVisible}`);
                    }
                    
                    // 测试5：重置功能
                    resetQuiz();
                    
                    setTimeout(() => {
                        const scoreAfterReset = document.getElementById('score').textContent;
                        const resultsHidden = document.getElementById('quiz-results').classList.contains('hidden');
                        const allUnchecked = document.querySelectorAll('input[type="radio"]:checked').length === 0;
                        
                        if (scoreAfterReset === '0' && resultsHidden && allUnchecked) {
                            logTestResult('重置功能', true, '重置功能正常工作');
                        } else {
                            logTestResult('重置功能', false, `重置功能异常，得分：${scoreAfterReset}，结果隐藏：${resultsHidden}，所有选项未选中：${allUnchecked}`);
                        }
                        
                        // 最终总结
                        const totalTests = document.querySelectorAll('.success, .error').length;
                        const passedTests = document.querySelectorAll('.success').length;
                        const failedTests = document.querySelectorAll('.error').length;
                        
                        logTestResult('测试总结', failedTests === 0, 
                            `所有测试完成！通过：${passedTests}/${totalTests}，失败：${failedTests}/${totalTests}`);
                        
                    }, 500);
                }, 500);
            }, 1000);
        }
        
        // 记录测试结果
        function logTestResult(testName, passed, message) {
            const output = document.getElementById('test-output');
            const resultDiv = document.createElement('div');
            resultDiv.className = passed ? 'success' : 'error';
            resultDiv.innerHTML = `<strong>${testName}:</strong> ${message}`;
            output.appendChild(resultDiv);
        }
        
        // 打开主页面
        function openMainPage() {
            window.open('index.html', '_blank');
        }
    </script>
</body>
</html>
