<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鸦片战争网站功能测试</title>
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e3a8a;
            border-bottom: 2px solid #1e3a8a;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #1e3a8a;
            background-color: #f8f9fa;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        button {
            background-color: #1e3a8a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #1e40af;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>鸦片战争网站功能测试</h1>
        <p>此页面测试鸦片战争历史教育网站的主要功能。</p>
        
        <div class="test-section">
            <h2>1. 页面可访问性测试</h2>
            <div id="page-access-test" class="test-result">
                正在测试...
            </div>
            <button onclick="testPageAccess()">运行页面访问测试</button>
        </div>
        
        <div class="test-section">
            <h2>2. 文件完整性测试</h2>
            <div id="file-test" class="test-result">
                正在测试...
            </div>
            <button onclick="testFiles()">运行文件完整性测试</button>
        </div>
        
        <div class="test-section">
            <h2>3. 链接功能测试</h2>
            <div id="link-test" class="test-result">
                正在测试...
            </div>
            <button onclick="testLinks()">运行链接测试</button>
        </div>
        
        <div class="test-section">
            <h2>4. 响应式设计测试</h2>
            <div id="responsive-test" class="test-result">
                正在测试...
            </div>
            <p>请手动调整浏览器窗口大小以测试响应式设计。</p>
        </div>
        
        <div class="test-section">
            <h2>5. 快速访问链接</h2>
            <p>
                <a href="http://localhost:8080/" target="_blank" style="color: #1e3a8a; text-decoration: none; font-weight: bold;">→ 访问主页面 (index.html)</a>
            </p>
            <p>
                <a href="http://localhost:8080/timeline.html" target="_blank" style="color: #1e3a8a; text-decoration: none; font-weight: bold;">→ 访问时间轴页面 (timeline.html)</a>
            </p>
        </div>
        
        <div class="test-section">
            <h2>测试结果摘要</h2>
            <div id="summary" class="test-result">
                等待测试运行...
            </div>
        </div>
    </div>

    <script>
        const requiredFiles = [
            'index.html',
            'timeline.html',
            'styles/main.css',
            'styles/timeline.css',
            'scripts/main.js',
            'scripts/quiz.js',
            'scripts/timeline.js'
        ];
        
        const requiredLinks = [
            { from: 'index.html', to: 'timeline.html', text: '时间轴链接' },
            { from: 'timeline.html', to: 'index.html', text: '返回首页链接' }
        ];
        
        let testResults = {
            pageAccess: false,
            files: false,
            links: false
        };
        
        function updateSummary() {
            const summary = document.getElementById('summary');
            const passed = Object.values(testResults).filter(v => v).length;
            const total = Object.keys(testResults).length;
            
            if (passed === total) {
                summary.className = 'test-result success';
                summary.innerHTML = `<strong>✓ 所有测试通过！</strong> (${passed}/${total}) - 网站功能正常。`;
            } else if (passed > 0) {
                summary.className = 'test-result warning';
                summary.innerHTML = `<strong>⚠ 部分测试通过</strong> (${passed}/${total}) - 请检查失败的测试。`;
            } else {
                summary.className = 'test-result error';
                summary.innerHTML = `<strong>✗ 测试失败</strong> (${passed}/${total}) - 网站功能可能有问题。`;
            }
        }
        
        async function testPageAccess() {
            const resultDiv = document.getElementById('page-access-test');
            resultDiv.innerHTML = '正在测试页面可访问性...';
            
            try {
                const response1 = await fetch('http://localhost:8080/');
                const response2 = await fetch('http://localhost:8080/timeline.html');
                
                if (response1.ok && response2.ok) {
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = '<strong>✓ 页面可访问性测试通过！</strong><br>' +
                                         '主页面 (index.html): HTTP ' + response1.status + '<br>' +
                                         '时间轴页面 (timeline.html): HTTP ' + response2.status;
                    testResults.pageAccess = true;
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.innerHTML = '<strong>✗ 页面可访问性测试失败</strong><br>' +
                                         '主页面: HTTP ' + response1.status + '<br>' +
                                         '时间轴页面: HTTP ' + response2.status;
                    testResults.pageAccess = false;
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = '<strong>✗ 页面可访问性测试失败</strong><br>' +
                                     '错误: ' + error.message;
                testResults.pageAccess = false;
            }
            
            updateSummary();
        }
        
        async function testFiles() {
            const resultDiv = document.getElementById('file-test');
            resultDiv.innerHTML = '正在测试文件完整性...';
            
            let missingFiles = [];
            let existingFiles = [];
            
            for (const file of requiredFiles) {
                try {
                    const response = await fetch('http://localhost:8080/' + file, { method: 'HEAD' });
                    if (response.ok) {
                        existingFiles.push(file);
                    } else {
                        missingFiles.push(file);
                    }
                } catch {
                    missingFiles.push(file);
                }
            }
            
            if (missingFiles.length === 0) {
                resultDiv.className = 'test-result success';
                resultDiv.innerHTML = '<strong>✓ 所有必需文件都存在！</strong><br>' +
                                     '找到的文件: ' + existingFiles.join(', ');
                testResults.files = true;
            } else {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = '<strong>✗ 缺少一些必需文件</strong><br>' +
                                     '找到的文件: ' + existingFiles.join(', ') + '<br>' +
                                     '缺失的文件: ' + missingFiles.join(', ');
                testResults.files = false;
            }
            
            updateSummary();
        }
        
        async function testLinks() {
            const resultDiv = document.getElementById('link-test');
            resultDiv.innerHTML = '正在测试链接功能...';
            
            // 对于这个简单测试，我们只检查链接是否存在
            // 在实际应用中，我们会解析HTML并验证链接
            try {
                const response1 = await fetch('http://localhost:8080/');
                const html1 = await response1.text();
                const hasTimelineLink = html1.includes('href="timeline.html"');
                
                const response2 = await fetch('http://localhost:8080/timeline.html');
                const html2 = await response2.text();
                const hasHomeLink = html2.includes('href="index.html"') || html2.includes('href="/"');
                
                if (hasTimelineLink && hasHomeLink) {
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = '<strong>✓ 链接功能测试通过！</strong><br>' +
                                         '主页面包含时间轴链接: ✓<br>' +
                                         '时间轴页面包含返回链接: ✓';
                    testResults.links = true;
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.innerHTML = '<strong>✗ 链接功能测试失败</strong><br>' +
                                         '主页面包含时间轴链接: ' + (hasTimelineLink ? '✓' : '✗') + '<br>' +
                                         '时间轴页面包含返回链接: ' + (hasHomeLink ? '✓' : '✗');
                    testResults.links = false;
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = '<strong>✗ 链接功能测试失败</strong><br>' +
                                     '错误: ' + error.message;
                testResults.links = false;
            }
            
            updateSummary();
        }
        
        // 页面加载时自动运行基本测试
        window.onload = function() {
            setTimeout(() => {
                testPageAccess();
                setTimeout(testFiles, 500);
                setTimeout(testLinks, 1000);
            }, 1000);
        };
    </script>
</body>
</html>
